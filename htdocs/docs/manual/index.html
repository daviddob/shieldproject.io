<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,target-densitydpi=device-dpi">
<meta name="generator" content="verse">
<meta name="X-UA-Compatible" content="IE=edge">


<title>SHIELD</title>


<style type="text/css">
h2 > span { padding-left: 0.5ex; }
</style>
<link rel="icon" href="/favicon.ico">
<link rel="stylesheet" href="/css/libs.css">
<link rel="stylesheet" href="/css/main.css">
<link rel="alternate home" type="application/rss+xml" title="SHIELD - RSS feed" href="/feed.xml">
</head>
<body class="dark-load">
	<header id="top-nav" class="top-nav page-header">
		<div class="container">
			<a class="logo smooth-scroll" href="https://starkandwayne.com/">
				<img class="logo-white" alt="Stark & Wayne" src="/img/logo.png" />
			</a>
			<nav class="top-menu">
				<ul class="sf-menu">
					<li><a href="/">Home</a></li>
					<li><a href="/download">Download</a></li>
					<li><a href="/community">Community</a></li>
					<li><a href="/docs/manual">Docs</a></li>
					<li><a href="/dev">Developers</a></li>
				</ul>
			</nav>
			<div id="mobile-menu">
				<div class="inner-wrap">
					<nav>
						<ul class="nav_menu">
							<li><a href="/">Home</a></li>
							<li><a href="/download">Download</a></li>
							<li><a href="/docs">Documentation</a></li>
							<li><a href="/dev">Developers</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</header>

	<section id="top" class="display-page img-parallax bg-mask background-image"
         data-image="/img/hbg.jpg">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>SHIELD Operator's Manual</h1>
      </div>
    </div>
  </div>
</section>


<section class="page">
 
    <a href="javascript:" id="return-to-top"><i class="icon-chevron-up"></i></a>
    
  <div id="container" class="container">
    <div class="row">
      <div class="col-md-3 toc">
        
      </div>
      <div class="col-md-8 col-md-push-1">
        <div class="content">
        <p>Hello, and welcome to the <strong>SHIELD Operator's Manual</strong>, an in-depth look at
all things SHIELD.  This guide aims to be an exhaustive guide to the
installation and operation of the SHIELD Data Protection solution.</p>

<p>If you are looking for a more easy-going start-up guide, you may want to
check out the <a href="/docs/getting-started">Getting Started</a> guide.</p>

<p>If you are interested in contributing to SHIELD itself, or wish to write a
plugin to extend the capabilities of your SHIELD installation, head on over
to the <a href="/devs">SHIELD Developer Documentation</a>.</p>

<h1>What is SHIELD?</h1>

<p>SHIELD is a <em>data protection</em> solution.  It is designed to run scheduled
tasks to backup your important data systems to off-site cloud storage
solutions, and facilitate the restoration of backup archives in the event of
outages or data loss.</p>

<p>SHIELD supports lots of different data systems, through its flexible and
modular plugin architecture.  We currently support:</p>

<ul>
<li><strong>PostgreSQL</strong> databases, via the <a href="/docs/plugins/postgres"><code>postgres</code> plugin</a>.</li>
<li><strong>MySQL</strong> / <strong>MariaDB</strong>, via the <a href="/docs/plugins/mysql"><code>mysql</code> plugin</a>, or the
<a href="/docs/plugins/xtrabackup"><code>xtrabackup</code> plugin</a>.</li>
<li><strong>Redis</strong> key-value store, via the <a href="/docs/plugins/redis"><code>redis</code> plugin</a>.</li>
<li>... and <a href="/docs/plugins#target-plugins">many more</a>.</li>
</ul>

<p>Cloud Storage systems are likewise pluggable.  Out of the box, SHIELD
supports:</p>

<ul>
<li><strong>Amazon S3</strong> (and S3 work-alikes) via the <a href="/docs/plugins/s3"><code>s3</code> plugin</a>.</li>
<li><strong>Microsoft Azure Blobstore</strong> via the <a href="/docs/plugins/azure"><code>azure</code> plugin</a>.</li>
<li><strong>GCP Blobstore</strong> via the <a href="/docs/plugins/google"><code>google</code> plugin</a>.</li>
<li>On-premise <strong>WebDAV</strong> endpoints, via the <a href="/docs/plugins/webdav"><code>webdav</code> plugin</a>.</li>
<li>... and <a href="/docs/plugins/#store-plugins">several others</a>.</li>
</ul>

<p>SHIELD is a distributed system.  The SHIELD <em>core</em> leverages a network of
<em>agents</em> to do the heavy lifting of data backup and restore.  When you
deploy SHIELD into your infrastructure, yet get to choose how many agents
you want to provision, and where in the network they sit.</p>

<p><em>Multi-tenancy</em> is baked right into SHIELD via a robust role-based access
control (RBAC) system in place to help isolate different subsets of users
from one another.  People in one tenant are unable to see configurations
made by people in another tenant.  This allows a single SHIELD to support
multiple, independent teams.</p>

<p>SHIELD also supports a sophisticated authentication system.  You can hook
up to your external Cloud Foundry UAA server, a BOSH UAA instance, or even
Github (both public and on-premise).  As users log in via their external
credentials, SHIELD will automatically create the necessary tenants and
assign roles based on the SHIELD configuration.</p>

<p>We believe strongly in encryption.  Whenever SHIELD communicates across the
network, it does so over encrypted channels (SSH, TLS/HTTPS), with endpoint
identity verification (host keys, mutual TLS, etc.).  All backup archives
are encrypted with unique key material, to ensure that data at-rest is also
resistent to snooping and tampering.</p>

<h1>Installation</h1>

<p>Before you can begin to use SHIELD to protect your important data, you're
going to need to install it.  You have three options: via <a href="https://bosh.io">BOSH</a>
(ideal for Cloud Foundry users), via <a href="https://docker.com">Docker</a>, and manually.</p>

<h2>Planning Your Installation</h2>

<p>Before you start installing the software, it's worthwhile to take a step
back and plan out your installation</p>

<h3>Network Topology</h3>

<p>SHIELD operates best on flat network topologies, without <abbr>NAT</abbr>
devices or HTTP(S) proxy services.</p>

<p><img src="/docs/manual/flat-topology.png" alt="A Flat Network Topology" title=""></p>

<p>SHIELD requires <em>mutual network visibility</em> between the core and all
cooperating agents.  Each agent issues a small HTTP request to the core,
to inform the core that it is alive, and ready to be inventoried.  This is
called the <em>registration ping</em>.  For each registration ping received, the
core records the name and port given and the remote address of the
connecting TCP socket.  At some later time, the SHIELD core will initiate an
SSH connection to the recorded agent IP address, and gather agent
information.</p>

<p>Because of this, NAT devices tend to confound SHIELD.  The registration ping
originats (at the TCP level) from the NAT gateway, not the host running the
SHIELD agent software.  When the core attempts to connect back to the agent,
it initiates a connection to the <em>NAT device</em> on the agent port, which
generally fails.</p>

<p>Flat networks with HTTP(S) proxies are not impossible, but they can be
unruly.  When configuring proxy clients (via <code>http_proxy</code> / <code>https_proxy</code>,
<code>no_proxy</code> environment varialbes, or similar mechanisms), you will want to
be especially cognizant of the HTTP(S) connections needed by the SHIELD
software itself.  Often, these connections will need to bypass am
Internet-bound proxy (i.e. one in a DMZ) in order to function.</p>

<p><img src="/docs/manual/proxied-topology.png" alt="A Proxied Network Topology" title=""></p>

<p>Likewise, if your cloud storage solution is to be dealt with over HTTP(S),
you will need to make sure that either your proxy server can contact it on
behalf of each SHIELD agent, or that each agent blacklists the domains
and/or IP addresses of the storage endpoints in something like <code>no_proxy</code>.</p>

<h3>Where to Colocate SHIELD Agents</h3>

<p>Depending on the data systems you wish to backup, and their configuration
with respect to access control, you may be able to get away without
colocating <em>any</em> SHIELD agents in your infrastructure.</p>

<p>There are really only two reasons for colocating a SHIELD agent on a data
system installation: plugin requirements and host access control
configuration.</p>

<p>Most SHIELD plugins stream their data through, without relying on any
temporary local storage.  This removes a throughput bottleneck (the disk),
as well as a capacity concern (how much temporary space do you need?).  Some
plugins, however, require local disk.  If the target system doesn't require
local access (more on that in a moment), you may want to spin up some
machines with large ephemeral disks just to handle these backup / restore
operations.  The conversation for backing up data then looks like this:</p>

<p><img src="/docs/manual/dedicated-shield-agent.png" alt="A Dedicated SHIELD Agent" title=""></p>

<p>Some plugins absolutely cannot be executed across the network.  The
<a href="/docs/plugins/fs">Filesystem Plugin</a>, for example, can only deal with files on the local
filesystem (networked filesystems notwithstanding).  Therefore, if you need
to back up files on a host, you will need to deploy a SHIELD agent to run on
that host.</p>

<h2>Using BOSH</h2>

<p><a href="https://bosh.io">BOSH</a> is a cloud-agnostic deployment and orchestration tool that
excels at lifecycle management of software at all scales.  SHIELD has a
<em>BOSH release</em> that can be used to deploy both the SHIELD core, and SHIELD
agents into new and existing BOSH deployments.</p>

<p>If you're already using BOSH (for example, if you are deploying Cloud
Foundry), adding SHIELD into your infrastructure should be easy.  If you are
still looking for a great release engineering framework, you can get your
feet wet with a SHIELD deployment or three.</p>

<p>The SHIELD BOSH release can be found <a href="https://github.com/starkandwayne/shield-boshrelease/releases">on Github</a>.</p>

<h3>Deploying the SHIELD Core</h3>

<p>Usually, the SHIELD core is a standalone, self-contained deployment.  To
deploy, you'll need to find or create a deployment manifest.  A good
starting point can be found <a href="/docs/manual/shield.yml">here</a>.</p>

<p>Save that file locally, as <code>shield.yml</code>, and then run:</p>

<pre><code>$ bosh -e my-bosh deploy \
    -d shield \
    -v static_ip=192.0.2.5 \
    -v domain=shield.example.com \
    shield.yml
</code></pre>

<p>Replace <code>domain</code> with the FQDN of your SHIELD management console, and
<code>192.0.2.5</code> with a static IP that you want to deploy SHIELD on.  You may
need to consult your BOSH <a href="https://bosh.io/docs/cloud-config">cloud-config</a> to find a suitable IP in
the <code>default</code> network.  Optionally, you may modify the deployment manifest
to specify a different network.</p>

<p><strong>NOTE</strong>: The provided deployment manifest assumes that your BOSH director
has been deployed with a <em>config-server</em> that can generate the necessary
certificates and keys for securing SHIELD's communications.  If that is not
the case, you will need to provide additional command-line options to the
<code>bosh deploy</code> command to store the generated credentials locally.  See
<a href="https://bosh.io/docs/cli-int/#vars-store">the BOSH documentation</a> for more information.</p>

<p>Once BOSH has finished deploying SHIELD, you should be able to access the
SHIELD management console at <a href="#">https://$IP</a>.  The default login will be
<code>admin</code> (username) and <code>shield</code> (password).</p>

<h3>Deploying SHIELD Agents</h3>

<p>If you need to colocate agents on other BOSH deployments, you have a few
options.  The fastest method is to modify those deployment manifests to
include the <code>shield-agent</code> job in the appropriate BOSH instance groups, like
this:</p>

<pre><code>instance_groups:
  - name: some-database
    jobs:
      # ... other jobs ....
      - name:    shield-agent
        release: shield

    # ... rest of configuration ...
</code></pre>

<p>This can get out of hand fast.  A more elegant solution is to use <a href="https://bosh.io/docs/runtime-config">BOSH
runtime configs</a> and <em>inject</em> the SHIELD agent job into other
deployments without mucking about with their deployment manifests.</p>

<p>Here's a working runtime config:</p>

<pre><code>---
releases:
  - name:    shield
    version: 8.0.8

addons:
  - name: shield
    jobs:
      - name:    shield-agent
        release: shield
</code></pre>

<p>To use this, update your existing runtime-config:</p>

<pre><code>$ bosh update-runtime-config addons.yml
</code></pre>

<p>Then, <code>bosh deploy</code> your pre-existing manifests, without changing them.
For more information, including how to limit the <code>shield</code> addon to just
specific deployments / VMs, read the
<a href="https://bosh.io/docs/runtime-config">BOSH runtime-configs documentation</a>.</p>

<h2>Using Docker</h2>

<h3>The SHIELD Core Image</h3>

<p>TBD</p>

<h3>The SHIELD Agent Standalone Image</h3>

<p>TBD</p>

<h3>Embedding the SHIELD Agent</h3>

<p>TBD</p>

<h2>Manual Installation</h2>

<p>TBD</p>

<h3>Deploying The SHIELD Core</h3>

<p>TBD</p>

<h3>Setting up the <code>nginx</code> Proxy</h3>

<p>TBD</p>

<h3>Deploying SHIELD Agents</h3>

<p>TBD</p>

<h2>Configuration Reference</h2>

<p>TBD</p>

<h1>Getting around in SHIELD</h1>

<p>TBD</p>

<h2>Logging into the Web UI</h2>

<p>TBD</p>

<h2>General Web UI Layout</h2>

<p>TBD</p>

<h2>The Web UI HUD / Health</h2>

<p>TBD</p>

<h2>Using the CLI</h2>

<p>TBD</p>

<h2>CLI Authentication</h2>

<p>TBD</p>

<h2>Auth Tokens</h2>

<p>TBD</p>

<h2>Getting help from the CLI</h2>

<p>TBD</p>

<h1>Configuring Backups</h1>

<p>TBD</p>

<h2>Wizard Walkthrough</h2>

<p>TBD</p>

<h2>The Systems Page</h2>

<p>TBD</p>

<h2>Adding a second schedule</h2>

<p>TBD</p>

<h1>Running Backups / Restores</h1>

<p>TBD</p>

<h2>Ad hoc vs. Scheduled</h2>

<p>TBD</p>

<h2>The Ad hoc backup Wizard</h2>

<p>TBD</p>

<h2>The Timeline View</h2>

<p>TBD</p>

<h2>Annotating Tasks</h2>

<p>TBD</p>

<h2>Restoring from the Timeline Page</h2>

<p>TBD</p>

<h2>The Restore Wizard</h2>

<p>TBD</p>

<h1>Managing Storage</h1>

<p>TBD</p>

<h2>How SHIELD Uses Cloud Storage</h2>

<p>TBD</p>

<h2>Retention Policies</h2>

<p>TBD</p>

<h2>How the HUD interacts</h2>

<p>TBD</p>

<h2>Storage Thresholds</h2>

<p>TBD</p>

<h2>The Storage Display Page</h2>

<p>TBD</p>

<h2>Shared Storage</h2>

<p>TBD</p>

<h1>Multi-Tenancy</h1>

<p>TBD</p>

<h2>What is a Tenant?</h2>

<p>TBD</p>

<h2>Switching Tenants</h2>

<p>TBD</p>

<h2>Role Assignments (and what they mean)</h2>

<p>TBD</p>

<h2>Authentication Providers and Tenants</h2>

<p>TBD</p>

<h3>UAA</h3>

<p>TBD</p>

<h3>Github</h3>

<p>TBD</p>

<h2>The default tenant</h2>

<p>TBD</p>

<h1>Encryption</h1>

<p>TBD</p>

<h2>What is Encryption</h2>

<p>TBD</p>

<h2>Why do I Care?</h2>

<p>TBD</p>

<h2>How does SHIELD use encryption?</h2>

<p>TBD</p>

<h2>At-rest vs. in-flight encryption</h2>

<p>TBD</p>

<h1>Administration</h1>

<p>TBD</p>

<h2>Initializing A SHIELD Core</h2>

<p>TBD</p>

<h2>The Master Password</h2>

<p>TBD</p>

<h2>The Administrative Backend</h2>

<p>TBD</p>

<h3>Tenants</h3>

<p>TBD</p>

<h3>Shared Storage</h3>

<p>TBD</p>

<h3>Retention Policy Templates</h3>

<p>TBD</p>

<h3>Managing Agents</h3>

<p>TBD</p>

<h3>Authentication Providers</h3>

<p>TBD</p>

<h3>Local User Management</h3>

<p>TBD</p>

<h3>Rekeying SHIELD</h3>

<p>TBD</p>

<h3>Session Management</h3>

<p>TBD</p>

<h1>How Do I Backup &lt;X&gt;?</h1>

<h2>SHIELD Itself</h2>

<h3>The Problem With Encryption</h3>

<p>TBD</p>

<h3>The Important Bits of SHIELD</h3>

<p>TBD</p>

<h3>Configuring the <code>fs</code> Plugin</h3>

<p>TBD</p>

<h3>"Normal-mode" Restores</h3>

<p>TBD</p>

<h2>Cloud Foundry UAA</h2>

<h2>Cloud Foundry CCDB</h2>

<h2>BOSH</h2>

<h1>Monitoring SHIELD</h1>

<p>TBD</p>

<h2>Using the HUD</h2>

<p>TBD</p>

<h2>API Access for Monitoring</h2>

<p>TBD</p>

<h2>Metrics of interest</h2>

<p>TBD</p>

<h2>Log messages to watch</h2>

<p>TBD</p>
      </div>
    </div>
  </div>
</section>

<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

	<footer>
		<div class="container">
			<div class="row">
				<div class="col-md-4">
					<a class="logo" href="https://starkandwayne.com/">
						<img class="logo-white" alt="Stark & Wayne" src="/img/logo.png" />
						<p><strong>SHIELD</strong> is funded and supported by <strong>Stark &amp; Wayne</strong>, the premier BOSH and Cloud Foundry consulting firm.<br>Stark &amp; Wayne: We Know Cloud.</p>
					</a>
				</div>

				<div class="col-md-4">
					<div class="links">
						<h5>SHIELD</h5>
						<ul class="list">
							<li><a href="/download">Download SHIELD</a></li>
							<li><a href="/docs/getting-started">Getting Started</a></li>
							<li><a href="/docs">Documentation</a></li>
							<li><a href="/community">Community Support</a></li>
						</ul>
					</div>
				</div>

				<div class="col-md-4">
					<div class="links">
						<h5>Reference</h5>
						<ul class="list">
							<li><a href="#">SHIELD Core</a></li>
							<li><a href="/dev/agent">SHIELD Agent</a></li>
							<li><a href="/dev/shield-cli-architecture">SHIELD CLI</a></li>
							<li><a href="/dev/plugins">Plugins</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<div class="down-footer">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<p>&copy; 2018 Stark &amp; Wayne.  All Rights Reserved.</p>
						<ul class="footer-menu"></ul>
					</div>
				</div>
			</div>
		</div>
	</footer>

	<!-- FIXME: these don't exist: -->
	<!--[if lt IE 9]>
		<script type="text/javascript" src="/libs/html5shiv/es5-shim.min.js"></script>
		<script type="text/javascript" src="/libs/html5shiv/html5shiv.min.js"></script>
		<script type="text/javascript" src="/libs/html5shiv/html5shiv-printshiv.min.js"></script>
		<script type="text/javascript" src="/libs/respond/respond.min.js"></script>
	<![endif]-->

	<script type="text/javascript" src="/libs/jquery/open_external_in_new_tab.js"></script>
	<script type="text/javascript" src="/js/libs.js"></script>
	<script type="text/javascript" src="/js/common.js"></script>
</body>
</html>
